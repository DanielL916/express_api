/**
 * Created by zenit1 on 29/12/2016.
 */
"use strict";

process.env.BEAME_LOG_LEVEL = "DEBUG";

const BeameStore = require('../../src/services/BeameStoreV2');
const fqdn =  'mvf4eyw6sbz54mny.p2payp4q8f5ruo22.v1.d.beameio.net';
const Credential  = require('../../src/services/Credential');
const CommonUtils = require('../../src/utils/CommonUtils');
//
let cred = new Credential( new BeameStore());

let token = cred.createRegistrationToken({fqdn, name:'zeev', email:'z@beame.io', userId : 'zeev', ttl : 84600}).then(function(base64token){

	let jsonToken = new Buffer(base64token, "base64").toString();
	let parsedAuthToken = token ? CommonUtils.parse(jsonToken) : null;

	let cred = new Credential(new BeameStore());

	cred.createEntityWithRegistrationToken(parsedAuthToken).then(metadata=>{
			console.log(metadata);
	});


}).catch(function(e){
	console.error(e);
});
